  <!DOCTYPE html>
  <html lang="ar" dir="rtl">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>لغز رياضي</title>
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
      <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
      <style>
          :root {
              --primary-color: #2c3e50;
              --secondary-color: #3498db;
              --accent-color: #e74c3c;
              --success-color: #27ae60;
              --error-color: #c0392b;
          }

          * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
          }

          body {
              font-family: 'Cairo', sans-serif;
              background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%);
              min-height: 100vh;
              display: flex;
              justify-content: center;
              align-items: center;
              padding: 20px;
              line-height: 1.6;
              color: var(--primary-color);
          }

          .container {
              max-width: 600px;
              width: 100%;
              background: rgba(255, 255, 255, 0.95);
              padding: 2rem;
              border-radius: 20px;
              box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
              backdrop-filter: blur(10px);
          }

          h1 {
              color: var(--primary-color);
              font-size: 2.5rem;
              margin-bottom: 1.5rem;
              text-align: center;
              position: relative;
              padding-bottom: 15px;
          }

          h1::after {
              content: '';
              position: absolute;
              bottom: 0;
              left: 50%;
              transform: translateX(-50%);
              width: 100px;
              height: 4px;
              background: linear-gradient(to right, var(--secondary-color), var(--accent-color));
              border-radius: 2px;
          }

          .puzzle-section {
              background: #fff;
              padding: 1.5rem;
              border-radius: 15px;
              margin: 1.5rem 0;
              box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
          }

          .puzzle-list {
              list-style: none;
              padding: 0;
              margin: 1.5rem 0;
          }

          .puzzle-list li {
              padding: 15px;
              margin: 10px 0;
              background: #f8f9fa;
              border-radius: 8px;
              font-size: 1.2rem;
              text-align: center;
              transition: transform 0.3s ease;
          }

          .puzzle-list li:hover {
              transform: scale(1.02);
          }

          .puzzle-list li.highlight {
              background: linear-gradient(45deg, #fff6e5, #ffe8cc);
              border: 2px dashed var(--accent-color);
              font-weight: bold;
              font-size: 1.4rem;
              color: var(--accent-color);
              padding: 20px;
          }

          input[type="text"] {
              width: 100%;
              padding: 12px 15px;
              margin: 10px 0;
              border: 2px solid #e0e0e0;
              border-radius: 8px;
              font-size: 1.1rem;
              font-family: 'Cairo', sans-serif;
              transition: all 0.3s ease;
          }

          input[type="text"]:focus {
              border-color: var(--secondary-color);
              box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
              outline: none;
          }

          button {
              width: 100%;
              padding: 12px 25px;
              background: linear-gradient(45deg, var(--secondary-color), #2980b9);
              color: white;
              border: none;
              border-radius: 8px;
              font-size: 1.2rem;
              cursor: pointer;
              font-family: 'Cairo', sans-serif;
              font-weight: 600;
              margin-top: 1rem;
              transition: all 0.3s ease;
          }

          button:hover {
              background: linear-gradient(45deg, #2980b9, var(--secondary-color));
              transform: translateY(-2px);
              box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
          }

          button:disabled {
              background: #cccccc;
              cursor: not-allowed;
              transform: none;
              box-shadow: none;
          }

          .form-group {
              margin-bottom: 1.5rem;
          }

          label {
              display: block;
              margin-bottom: 8px;
              font-weight: 600;
              color: var(--primary-color);
              font-size: 1.1rem;
          }

          #result {
              margin-top: 1.5rem;
              padding: 15px;
              border-radius: 8px;
              text-align: center;
              font-size: 1.2rem;
              font-weight: 600;
              display: none;
          }

          #result.success {
              background-color: rgba(39, 174, 96, 0.1);
              color: var(--success-color);
              border: 2px solid var(--success-color);
          }

          #result.error {
              background-color: rgba(192, 57, 43, 0.1);
              color: var(--error-color);
              border: 2px solid var(--error-color);
          }

          .loading {
              display: none;
              text-align: center;
              margin: 20px 0;
          }

          .loading .spinner {
              width: 40px;
              height: 40px;
              margin: 0 auto;
              border: 4px solid #f3f3f3;
              border-top: 4px solid var(--secondary-color);
              border-radius: 50%;
              animation: spin 1s linear infinite;
          }

          @keyframes spin {
              0% { transform: rotate(0deg); }
              100% { transform: rotate(360deg); }
          }

          .blocked-message {
              background-color: #fff3cd;
              color: #856404;
              border: 1px solid #ffeeba;
              padding: 20px;
              border-radius: 8px;
              text-align: center;
              margin: 20px 0;
              font-size: 1.1rem;
          }

          .timer-message {
              background-color: #cce5ff;
              color: #004085;
              border: 1px solid #b8daff;
              padding: 15px;
              border-radius: 8px;
              text-align: center;
              margin: 10px 0;
              font-size: 1rem;
          }
      </style>
  </head>
  <body>
      <div class="container animate__animated animate__fadeIn">
          <h1>لغز رياضي ممتع</h1>
          
          <div class="puzzle-section">
              <p style="text-align: center; font-size: 1.2rem; margin-bottom: 1rem;">أكمل النمط التالي:</p>
              <ul class="puzzle-list">
                  <li class="animate__animated animate__fadeInRight">1 × 2 = 5</li>
                  <li class="animate__animated animate__fadeInRight" style="animation-delay: 0.1s">2 × 2 = 20</li>
                  <li class="animate__animated animate__fadeInRight" style="animation-delay: 0.2s">2 × 3 = 43</li>
                  <li class="animate__animated animate__fadeInRight" style="animation-delay: 0.3s">3 × 3 = 90</li>
                  <li class="highlight animate__animated animate__fadeInRight" style="animation-delay: 0.4s">4 × 3 = ❓</li>
              </ul>
          </div>

          <div id="formSection" class="puzzle-section">
              <form id="puzzleForm">
                  <div class="form-group">
                      <label for="name">الاسم</label>
                      <input type="text" id="name" required placeholder="أدخل اسمك الكامل">
                  </div>

                  <div class="form-group">
                      <label for="answer">الإجابة</label>
                      <input type="text" id="answer" required placeholder="أدخل إجابتك">
                  </div>

                  <button type="submit" id="submitBtn">تحقق من إجابتك</button>
              </form>

              <div id="result"></div>
              <div class="loading" id="loading">
                  <div class="spinner"></div>
                  <p>جاري التحقق من إجابتك...</p>
              </div>
          </div>
      </div>

      <script>
          (function() {
              emailjs.init("Non4_CdtCimLox-Ow");

              const BLOCK_DURATION = 24 * 60 * 60 * 1000; // 24 ساعة
              let userIP = null;

              async function getUserIP() {
                  try {
                      const response = await fetch('https://api.ipify.org?format=json');
                      const data = await response.json();
                      return data.ip;
                  } catch (error) {
                      console.error('Error fetching IP:', error);
                      return null;
                  }
              }

              function showResult(message, type) {
                  const resultDiv = document.getElementById('result');
                  const loadingDiv = document.getElementById('loading');
                  
                  loadingDiv.style.display = 'none';
                  resultDiv.textContent = message;
                  resultDiv.className = type;
                  resultDiv.style.display = 'block';
              }

              async function sendEmail(name, answer, isCorrect) {
                  try {
                      const templateParams = {
                          to_email: "motaz-2010@hotmail.com",
                          from_name: name,
                          message: `
                              اسم المشارك: ${name}
                              الإجابة: ${answer}
                              النتيجة: ${isCorrect ? 'صحيحة' : 'خاطئة'}
                              عنوان IP: ${userIP}
                              التاريخ: ${new Date().toLocaleString('ar-SA')}
                          `
                      };

                      const response = await emailjs.send(
                          "service_za7kjb6",
                          "template_90rsv3y",
                          templateParams
                      );

                      return true;
                  } catch (error) {
                      console.error("خطأ في إرسال البريد:", error);
                      return false;
                  }
              }

              function checkPreviousAttempt() {
                  if (!userIP) return false;

                  const storedData = localStorage.getItem(`puzzle_attempt_${userIP}`);
                  if (!storedData) return false;

                  const { timestamp } = JSON.parse(storedData);
                  const now = new Date().getTime();
                  const timeDiff = now - timestamp;

                  if (timeDiff < BLOCK_DURATION) {
                      const remainingHours = Math.floor((BLOCK_DURATION - timeDiff) / (1000 * 60 * 60));
                      const remainingMinutes = Math.floor(((BLOCK_DURATION - timeDiff) % (1000 * 60 * 60)) / (1000 * 60));

                      const formSection = document.getElementById('formSection');
                      formSection.innerHTML = `
                          <div class="blocked-message">
                              <h2>عذراً!</h2>
                              <p>لقد قمت بحل اللغز مسبقاً</p>
                              <div class="timer-message">
                                  يمكنك المحاولة مرة أخرى بعد ${remainingHours} ساعة و ${remainingMinutes} دقيقة
                              </div>
                          </div>
                      `;
                      return true;
                  }

                  localStorage.removeItem(`puzzle_attempt_${userIP}`);
                  return false;
              }

              document.getElementById('puzzleForm').addEventListener('submit', async function(event) {
                  event.preventDefault();

                  const submitBtn = document.getElementById('submitBtn');
                  const loadingDiv = document.getElementById('loading');
                  const name = document.getElementById('name').value.trim();
                  const answer = document.getElementById('answer').value.trim();

                  if (!name || !answer) {
                      showResult('يرجى تعبئة جميع الحقول المطلوبة', 'error');
                      return;
                  }

                  submitBtn.disabled = true;
                  loadingDiv.style.display = 'block';

                  const correctAnswer = "153";
                  const isCorrect = answer === correctAnswer;

                  if (userIP) {
                      localStorage.setItem(`puzzle_attempt_${userIP}`, JSON.stringify({
                          timestamp: new Date().getTime(),
                          name: name,
                          answer: answer,
                          isCorrect: isCorrect
                      }));
                  }

                  const emailSent = await sendEmail(name, answer, isCorrect);

                  if (isCorrect) {
                      showResult('🎉 إجابة صحيحة! أحسنت يا ' + name, 'success');
                  } else {
                      showResult('للأسف إجابة غير صحيحة. حاول مرة أخرى بعد 24 ساعة!', 'error');
                  }

                  setTimeout(() => {
                      const formSection = document.getElementById('formSection');
                      formSection.innerHTML = `
                          <div class="puzzle-section">
                              <h2 style="text-align: center; color: var(--primary-color);">شكراً لمشاركتك!</h2>
                              <p style="text-align: center; margin-top: 15px;">
                                  ${isCorrect ? 
                                      'تهانينا! لقد حللت اللغز بنجاح. 🎉' : 
                                      'شكراً لمحاولتك! يمكنك المحاولة مرة أخرى بعد 24 ساعة.'}
                              </p>
                              <p style="text-align: center; margin-top: 10px; color: ${emailSent ? 'green' : 'red'}">
                                  ${emailSent ? 
                                      'تم تسجيل مشاركتك بنجاح' : 
                                      'حدث خطأ في تسجيل المشاركة، يرجى المحاولة مرة أخرى لاحقاً'}
                              </p>
                          </div>
                      `;
                  }, 3000);
              });

              (async function init() {
                  userIP = await getUserIP();
                  checkPreviousAttempt();
              })();
          })();
      </script>
  </body>
  </html>
